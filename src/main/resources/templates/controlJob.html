<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DG Admin - Qu·∫£n l√Ω Tuy·ªÉn D·ª•ng</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <style>
        /* --- GI·ªÆ NGUY√äN CSS C≈® --- */
        :root {
            --grad-primary: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
            --grad-hover: linear-gradient(135deg, #FF4757 0%, #FF6B6B 100%);
            --color-orange: #FF6B6B;
            --color-pink: #FF4757;
            --bg-body: #FFFBFB;
            --text-dark: #2D3436;
            --text-sub: #636E72;
            --shadow-soft: 0 10px 30px rgba(255, 107, 107, 0.1);
            --radius: 20px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-dark);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .bg-mesh { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1; overflow: hidden; pointer-events: none; }
        .orb { position: absolute; border-radius: 50%; filter: blur(90px); opacity: 0.5; animation: float 20s infinite alternate ease-in-out; }
        .orb-1 { width: 500px; height: 500px; background: #FFEAA7; top: -100px; left: -100px; }
        .orb-2 { width: 400px; height: 400px; background: #FFD3E0; bottom: 10%; right: -50px; }
        @keyframes float { 0% { transform: translate(0, 0); } 100% { transform: translate(30px, 30px); } }

        .header { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid rgba(255, 107, 107, 0.1); }
        .nav { display: flex; justify-content: space-between; align-items: center; max-width: 1400px; margin: auto; padding: 1rem 2rem; }
        .logo { font-size: 2rem; font-weight: 800; letter-spacing: -1px; background: var(--grad-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; cursor: pointer; }
        .nav-menu { display: flex; list-style: none; gap: 1rem; align-items: center; }
        .nav-menu a { color: var(--text-sub); text-decoration: none; font-weight: 600; padding: 0.5rem 1rem; border-radius: 50px; transition: all 0.3s; }
        .nav-menu a:hover { color: var(--color-orange); background: #FFF0F0; transform: translateY(-2px); }
        .mobile-menu-btn { display: none; background: none; border: none; color: var(--color-orange); font-size: 1.5rem; cursor: pointer; }

        .container { max-width: 1400px; margin: 2rem auto; padding: 0 2rem; }
        .dashboard-header { background: linear-gradient(135deg, #FFF0F0 0%, #FFEAA7 100%); border-radius: var(--radius); padding: 2.5rem; margin-bottom: 2rem; box-shadow: var(--shadow-soft); border: 1px solid white; }
        .dashboard-header h1 { color: var(--text-dark); margin-bottom: 0.5rem; font-weight: 800; font-size: 2rem; background: var(--grad-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .dashboard-header p { color: var(--text-sub); font-size: 1.1rem; }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background: white; border-radius: var(--radius); padding: 1.5rem; box-shadow: var(--shadow-soft); border: 1px solid #FFF0F0; display: flex; align-items: center; gap: 1rem; transition: transform 0.3s; }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-icon { width: 60px; height: 60px; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .stat-icon.primary { background: #FFF0F0; color: var(--color-orange); }
        .stat-icon.success { background: #E3FCEF; color: #00B894; }
        .stat-icon.warning { background: #FFF4E6; color: #F39C12; }
        .stat-icon.danger { background: #FFEBEB; color: #FF4757; }
        .stat-info h3 { font-size: 1.8rem; color: var(--text-dark); margin-bottom: 0; line-height: 1; }
        .stat-info p { color: var(--text-sub); font-size: 0.9rem; font-weight: 500; margin-top: 5px; }

        .control-panel { background: white; border-radius: var(--radius); padding: 1.5rem; margin-bottom: 2rem; box-shadow: var(--shadow-soft); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; border: 1px solid #FFF0F0; }
        .search-box { flex: 1; min-width: 300px; position: relative; }
        .search-box input { width: 100%; padding: 0.8rem 1rem 0.8rem 2.8rem; border: 2px solid #F5F6FA; border-radius: 50px; outline: none; transition: 0.3s; font-family: 'Outfit'; color: var(--text-dark); }
        .search-box input:focus { border-color: var(--color-orange); background: #FFF0F0; }
        .search-icon { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: #B2BEC3; }
        .filter-select { padding: 0.8rem 1.5rem; border: 2px solid #F5F6FA; border-radius: 50px; outline: none; cursor: pointer; background: white; font-family: 'Outfit'; color: var(--text-sub); font-weight: 600; transition: 0.3s; }
        .filter-select:focus, .filter-select:hover { border-color: var(--color-orange); color: var(--color-orange); }
        .btn-create-job { background: var(--grad-primary); color: white; padding: 0.8rem 2rem; border: none; border-radius: 50px; cursor: pointer; font-weight: 700; transition: all 0.3s; text-decoration: none; display: flex; align-items: center; gap: 0.5rem; box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3); }
        .btn-create-job:hover { transform: scale(1.05); background: var(--grad-hover); }

        .table-container { background: white; border-radius: var(--radius); box-shadow: var(--shadow-soft); overflow: hidden; border: 1px solid #FFF0F0; }
        table { width: 100%; border-collapse: collapse; }
        thead { background: var(--grad-primary); color: white; }
        th { padding: 1.2rem; text-align: left; font-weight: 700; font-size: 0.95rem; text-transform: uppercase; letter-spacing: 0.5px; }
        td { padding: 1.2rem; border-bottom: 1px solid #F5F6FA; color: var(--text-sub); vertical-align: middle; }
        tbody tr:hover { background-color: #FFF9F9; }
        .status-badge { display: inline-block; padding: 0.4rem 1rem; border-radius: 50px; font-size: 0.85rem; font-weight: 700; }
        .status-badge.dang-tuyen { background: #E3FCEF; color: #00B894; }
        .status-badge.da-dong { background: #FFEBEB; color: #FF4757; }
        .status-badge.tam-dung { background: #FFF4E6; color: #F39C12; }
        .status-badge.sap-mo { background: #EBF8FF; color: #3498DB; }
        .action-buttons { display: flex; gap: 0.5rem; }
        .btn-action { width: 35px; height: 35px; border: none; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; font-size: 0.9rem; text-decoration: none; }
        .btn-action:hover { transform: scale(1.15); }
        .btn-view-detail { background: #EBF8FF; color: #3498DB; }
        .btn-edit { background: #E3FCEF; color: #00B894; }
        .btn-delete { background: #FFEBEB; color: #FF4757; }

        .pagination-container { display: flex; justify-content: space-between; align-items: center; padding: 1.5rem; background: white; border-top: 1px solid #F5F6FA; }
        .pagination-info { color: var(--text-sub); font-size: 0.9rem; font-weight: 500; }
        .pagination-info span { color: var(--color-orange); font-weight: 700; }
        .pagination { display: flex; gap: 0.5rem; align-items: center; }
        .page-btn { width: 35px; height: 35px; border: 2px solid #F5F6FA; background: white; border-radius: 50%; cursor: pointer; font-weight: 600; transition: all 0.3s; color: var(--text-sub); display: flex; align-items: center; justify-content: center; }
        .page-btn:hover:not(:disabled) { border-color: var(--color-orange); color: var(--color-orange); }
        .page-btn.active { background: var(--grad-primary); color: white; border-color: transparent; box-shadow: 0 5px 10px rgba(255, 107, 107, 0.3); }
        .page-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .page-size-select { padding: 0.5rem; border: 2px solid #F5F6FA; border-radius: 10px; cursor: pointer; margin-left: 1rem; color: var(--text-sub); font-family: 'Outfit'; }

        /* --- MODAL CSS M·ªöI --- */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(5px);
            z-index: 2000; justify-content: center; align-items: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white; border-radius: var(--radius); padding: 2rem;
            max-width: 800px; width: 95%; max-height: 90vh; overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1); border: 1px solid #FFF0F0;
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }

        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; border-bottom: 2px solid #F5F6FA; padding-bottom: 1rem; }
        .modal-header h2 { color: var(--text-dark); margin: 0; font-size: 1.5rem; font-weight: 800; display: flex; align-items: center; gap: 0.5rem; }
        .close-modal { background: none; border: none; font-size: 2rem; color: var(--text-sub); cursor: pointer; transition: 0.3s; line-height: 1; }
        .close-modal:hover { color: var(--color-pink); transform: rotate(90deg); }

        .modal-body { padding: 0.5rem 0; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.4rem; font-weight: 600; color: var(--text-dark); font-size: 0.9rem; }
        .form-group label.required::after { content: " *"; color: #FF4757; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%; padding: 0.7rem 1rem; border: 2px solid #F5F6FA;
            border-radius: 12px; outline: none; transition: 0.3s;
            font-family: 'Outfit'; color: var(--text-dark); background: #FDFDFD;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: var(--color-orange); background: white;
        }
        .full-width { grid-column: 1 / -1; }

        .modal-footer { display: flex; gap: 1rem; margin-top: 1.5rem; border-top: 2px solid #F5F6FA; padding-top: 1.5rem; }
        .btn-save { flex: 2; padding: 0.8rem; background: var(--grad-primary); color: white; border: none; border-radius: 50px; font-weight: 700; cursor: pointer; transition: 0.3s; box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3); }
        .btn-save:hover { transform: translateY(-2px); background: var(--grad-hover); }
        .btn-close { flex: 1; padding: 0.8rem; background: #F5F6FA; color: var(--text-sub); border: none; border-radius: 50px; font-weight: 600; cursor: pointer; transition: 0.3s; }
        .btn-close:hover { background: #E2E8F0; }

        @media (max-width: 768px) {
            .nav-menu { display: none; }
            .control-panel { flex-direction: column; }
            .search-box { width: 100%; }
            .action-buttons { flex-direction: row; }
            .pagination-container { flex-direction: column; gap: 1rem; }
            .form-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>

<body>
    <div class="bg-mesh">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
    </div>

    <header class="header">
        <nav class="nav">
            <div class="logo">DG Jobs</div>
            <ul class="nav-menu" id="navMenu">
                <li><a href="testHome.html">T√¨m vi·ªác</a></li>
                <li><a href="createJob.html">ƒêƒÉng tin</a></li>
                <li><a href="#ve-chung-toi">V·ªÅ ch√∫ng t√¥i</a></li>
                <li><a href="testHome.html">ƒêƒÉng xu·∫•t</a></li>
                <li><a href="testProfileCandidate.html">Profile</a></li>
            </ul>
            <button class="mobile-menu-btn" id="mobileMenuBtn"><i class="fa-solid fa-bars"></i></button>
        </nav>
    </header>

    <div class="container">
        <div class="dashboard-header">
            <h1><i class="fa-solid fa-layer-group"></i> Qu·∫£n l√Ω Tuy·ªÉn D·ª•ng</h1>
            <p>Xem, t·∫°o v√† qu·∫£n l√Ω t·∫•t c·∫£ c√°c v·ªã tr√≠ ƒëang tuy·ªÉn d·ª•ng trong h·ªá th·ªëng</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon primary"><i class="fa-solid fa-briefcase"></i></div>
                <div class="stat-info"><h3 id="totalJobs">0</h3><p>T·ªïng v·ªã tr√≠</p></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon success"><i class="fa-solid fa-bullhorn"></i></div>
                <div class="stat-info"><h3 id="activeJobs">0</h3><p>ƒêang tuy·ªÉn</p></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon warning"><i class="fa-solid fa-pause"></i></div>
                <div class="stat-info"><h3 id="pausedJobs">0</h3><p>T·∫°m d·ª´ng</p></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon danger"><i class="fa-solid fa-lock"></i></div>
                <div class="stat-info"><h3 id="closedJobs">0</h3><p>ƒê√£ ƒë√≥ng</p></div>
            </div>
        </div>

        <div class="control-panel">
            <div class="search-box">
                <span class="search-icon"><i class="fa-solid fa-magnifying-glass"></i></span>
                <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm theo t√™n job, c√¥ng ty...">
            </div>
            <div class="filter-group">
                <select class="filter-select" id="statusFilter">
                    <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                    <option value="ƒêang tuy·ªÉn">ƒêang tuy·ªÉn</option>
                    <option value="T·∫°m d·ª´ng">T·∫°m d·ª´ng</option>
                    <option value="S·∫Øp m·ªü">S·∫Øp m·ªü</option>
                    <option value="ƒê√£ ƒë√≥ng">ƒê√£ ƒë√≥ng</option>
                </select>
                <a href="createJob.html" class="btn-create-job">
                    <i class="fa-solid fa-plus"></i> T·∫°o Job m·ªõi
                </a>
            </div>
        </div>

        <div class="table-container">
            <div id="loadingState" class="loading">
                <div class="spinner"></div>
                <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
            </div>
            <table id="jobTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>T√™n C√¥ng vi·ªác</th>
                        <th>C√¥ng ty</th>
                        <th>M·ª©c L∆∞∆°ng</th>
                        <th>H·∫°n ch√≥t</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th>Thao t√°c</th>
                    </tr>
                </thead>
                <tbody id="jobTableBody"></tbody>
            </table>

            <div class="pagination-container" id="paginationContainer" style="display: none;">
                <div class="pagination-info">
                    Hi·ªÉn th·ªã <span id="showingFrom">0</span> - <span id="showingTo">0</span>
                    trong <span id="totalElements">0</span> jobs
                </div>
                <div style="display: flex; align-items: center;">
                    <div class="pagination" id="pagination">
                        <button class="page-btn" id="firstBtn" onclick="goToPage(0)"><i class="fa-solid fa-angles-left"></i></button>
                        <button class="page-btn" id="prevBtn" onclick="goToPage(currentPage - 1)"><i class="fa-solid fa-angle-left"></i></button>
                        <div id="pageNumbers" style="display: flex; gap: 0.5rem;"></div>
                        <button class="page-btn" id="nextBtn" onclick="goToPage(currentPage + 1)"><i class="fa-solid fa-angle-right"></i></button>
                        <button class="page-btn" id="lastBtn" onclick="goToPage(totalPages - 1)"><i class="fa-solid fa-angles-right"></i></button>
                    </div>
                    <select class="page-size-select" id="pageSizeSelect" onchange="changePageSize()">
                        <option value="5">5 / trang</option>
                        <option value="10" selected>10 / trang</option>
                        <option value="20">20 / trang</option>
                        <option value="50">50 / trang</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="editJobModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fa-solid fa-pen-to-square" style="color: var(--color-orange);"></i> C·∫≠p nh·∫≠t Job</h2>
                <button class="close-modal" onclick="closeEditModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="editJobForm">
                    <input type="hidden" id="editJobId">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="required">T√™n C√¥ng Vi·ªác</label>
                            <input type="text" id="editTitle" required>
                        </div>
                        <div class="form-group">
                            <label class="required">C√¥ng Ty</label>
                            <input type="text" id="editCompany" required>
                        </div>
                        <div class="form-group">
                            <label class="required">Ng√†y B·∫Øt ƒê·∫ßu</label>
                            <input type="date" id="editStartDate" required>
                        </div>
                        <div class="form-group">
                            <label class="required">Ng√†y K·∫øt Th√∫c</label>
                            <input type="date" id="editEndDate" required>
                        </div>
                        <div class="form-group">
                            <label>L∆∞∆°ng T·ª´ (Tri·ªáu)</label>
                            <input type="number" id="editSalaryFrom">
                        </div>
                        <div class="form-group">
                            <label>L∆∞∆°ng ƒê·∫øn (Tri·ªáu)</label>
                            <input type="number" id="editSalaryTo">
                        </div>
                        <div class="form-group">
                            <label class="required">C·∫•p B·∫≠c</label>
                            <select id="editLevel">
                                <option value="Intern">Intern</option>
                                <option value="Fresher">Fresher</option>
                                <option value="Junior">Junior</option>
                                <option value="Senior">Senior</option>
                                <option value="Manager">Manager</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="required">Tr·∫°ng Th√°i</label>
                            <select id="editStatus">
                                <option value="Draft">Nh√°p</option>
                                <option value="Published">ƒêang tuy·ªÉn</option>
                                <option value="Paused">T·∫°m d·ª´ng</option>
                                <option value="Archived">L∆∞u tr·ªØ</option>
                            </select>
                        </div>
                        <div class="form-group full-width">
                            <label class="required">ƒê·ªãa Ch·ªâ</label>
                            <input type="text" id="editAddress" required>
                        </div>
                        <div class="form-group full-width">
                            <label>K·ªπ NƒÉng (c√°ch nhau b·ªüi d·∫•u ph·∫©y)</label>
                            <textarea id="editSkills" rows="2"></textarea>
                        </div>
                        <div class="form-group full-width">
                            <label>M√¥ T·∫£</label>
                            <textarea id="editDescription" rows="3"></textarea>
                        </div>
                        <div class="form-group full-width">
                            <label>Ph√∫c L·ª£i</label>
                            <textarea id="editBenefits" rows="2"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-close" onclick="closeEditModal()">H·ªßy b·ªè</button>
                        <button type="submit" class="btn-save">L∆∞u thay ƒë·ªïi</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8080/job'; 
        let currentPage = 0;
        let pageSize = 10;
        let totalPages = 0;
        let totalElements = 0;
        let searchTimeout;

        function getStatusClass(status) {
            const statusMap = { 'ƒêang tuy·ªÉn': 'dang-tuyen', 'T·∫°m d·ª´ng': 'tam-dung', 'S·∫Øp m·ªü': 'sap-mo', 'ƒê√£ ƒë√≥ng': 'da-dong', 'Published': 'dang-tuyen' };
            return statusMap[status] || 'pending';
        }

        function formatSalary(from, to) {
            const formatVND = (num) => {
                if (!num) return 'N/A';
                return (num).toFixed(1).replace(/\.0$/, '') + 'M';
            };
            if (from && to) return `${formatVND(from)} - ${formatVND(to)} VNƒê`;
            else if (from) return `T·ª´ ${formatVND(from)} VNƒê`;
            else return 'Th∆∞∆°ng l∆∞·ª£ng';
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            try { return dateString.split('-').reverse().join('/'); } catch (e) { return dateString; }
        }

        // --- H√ÄM T·∫¢I D·ªÆ LI·ªÜU ---
        async function loadJobs() {
            try {
                document.getElementById('loadingState').style.display = 'block';
                document.getElementById('jobTableBody').innerHTML = '';

                const searchTerm = document.getElementById('searchInput').value.trim();
                const statusFilter = document.getElementById('statusFilter').value;

                const params = { page: currentPage, size: pageSize, sortBy: 'jobId', sortDir: 'desc' };
                if (searchTerm) params.search = searchTerm;
                if (statusFilter) params.status = statusFilter;

                const response = await axios.get(`${API_BASE_URL}/jobs`, { params: params, withCredentials: true });
                const pageData = response.data;
                
                totalPages = pageData.totalPages;
                totalElements = pageData.totalElements;

                await loadStats();
                renderTable(pageData.content);
                renderPagination();

                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('paginationContainer').style.display = totalElements > 0 ? 'flex' : 'none';
            } catch (error) {
                console.error('L·ªói khi t·∫£i d·ªØ li·ªáu Job:', error);
                document.getElementById('loadingState').innerHTML = '<p style="color: #FF4757;">Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu.</p>';
            }
        }

        async function loadStats() {
            try {
                const allResponse = await axios.get(`${API_BASE_URL}/jobs`, { params: { page: 0, size: 1 }, withCredentials: true });
                document.getElementById('totalJobs').textContent = allResponse.data.totalElements;
            } catch (error) { console.error(error); }
        }

        function renderTable(jobs) {
            const tbody = document.getElementById('jobTableBody');
            if (jobs.length === 0) {
                tbody.innerHTML = `<tr><td colspan="7" class="empty-state"><div class="empty-state-icon">üö´</div><p><strong>Kh√¥ng t√¨m th·∫•y job n√†o</strong></p></td></tr>`;
                return;
            }

            tbody.innerHTML = jobs.map(job => `
                <tr>
                    <td>#${job.jobId}</td>
                    <td><strong>${job.title || 'N/A'}</strong></td>
                    <td>${job.companyName || 'N/A'}</td>
                    <td>${formatSalary(job.salaryFrom, job.salaryTo)}</td>
                    <td>${formatDate(job.endDate)}</td>
                    <td><span class="status-badge ${getStatusClass(job.status)}">${job.status || 'N/A'}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-action btn-edit" onclick="openEditModal(${job.jobId})" title="S·ª≠a"><i class="fa-solid fa-pen"></i></button>
                            <a href="jobDetail.html?id=${job.jobId}" class="btn-action btn-view-detail" title="Chi ti·∫øt"><i class="fa-solid fa-eye"></i></a>
                            <button class="btn-action btn-delete" onclick="deleteJob(${job.jobId})" title="X√≥a"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // --- C√ÅC H√ÄM X·ª¨ L√ù MODAL EDIT ---
        async function openEditModal(id) {
            try {
                // G·ªçi API l·∫•y chi ti·∫øt Job
                const response = await axios.get(`${API_BASE_URL}/${id}`, { withCredentials: true });
                const job = response.data;

                // Fill d·ªØ li·ªáu v√†o form
                document.getElementById('editJobId').value = job.jobId;
                document.getElementById('editTitle').value = job.title;
                document.getElementById('editCompany').value = job.companyName;
                document.getElementById('editStartDate').value = job.startDate;
                document.getElementById('editEndDate').value = job.endDate;
                document.getElementById('editSalaryFrom').value = job.salaryFrom;
                document.getElementById('editSalaryTo').value = job.salaryTo;
                document.getElementById('editLevel').value = job.level;
                document.getElementById('editStatus').value = job.status;
                document.getElementById('editAddress').value = job.workingAddress;
                document.getElementById('editSkills').value = job.skills;
                document.getElementById('editDescription').value = job.description;
                document.getElementById('editBenefits').value = job.benefits;

                // Hi·ªÉn th·ªã Modal
                document.getElementById('editJobModal').classList.add('active');
            } catch (error) {
                console.error(error);
                alert('Kh√¥ng th·ªÉ t·∫£i th√¥ng tin Job. Vui l√≤ng th·ª≠ l·∫°i.');
            }
        }

        function closeEditModal() {
            document.getElementById('editJobModal').classList.remove('active');
        }

        // X·ª≠ l√Ω Submit Form Edit
        document.getElementById('editJobForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const id = document.getElementById('editJobId').value;
            
            const updatedJob = {
                title: document.getElementById('editTitle').value,
                companyName: document.getElementById('editCompany').value,
                startDate: document.getElementById('editStartDate').value,
                endDate: document.getElementById('editEndDate').value,
                salaryFrom: document.getElementById('editSalaryFrom').value,
                salaryTo: document.getElementById('editSalaryTo').value,
                level: document.getElementById('editLevel').value,
                status: document.getElementById('editStatus').value,
                workingAddress: document.getElementById('editAddress').value,
                skills: document.getElementById('editSkills').value,
                description: document.getElementById('editDescription').value,
                benefits: document.getElementById('editBenefits').value
            };

            try {
                // G·ªçi API Update (Theo controller b·∫°n cung c·∫•p ·ªü Turn 9)
                await axios.put(`${API_BASE_URL}/updateJob/${id}`, updatedJob, { withCredentials: true });
                alert('C·∫≠p nh·∫≠t Job th√†nh c√¥ng!');
                closeEditModal();
                loadJobs(); // Reload b·∫£ng
            } catch (error) {
                console.error(error);
                alert('L·ªói c·∫≠p nh·∫≠t: ' + (error.response ? error.response.data : error.message));
            }
        });

        // --- C√ÅC H√ÄM KH√ÅC (DELETE, SEARCH, PAGINATION) ---
        async function deleteJob(id) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a v·ªã tr√≠ tuy·ªÉn d·ª•ng n√†y?')) return;
            try {
                await axios.delete(`${API_BASE_URL}/deleteJob/${id}`, { withCredentials: true });
                alert('X√≥a Job th√†nh c√¥ng!');
                loadJobs();
            } catch (error) {
                alert('Kh√¥ng th·ªÉ x√≥a Job. L·ªói: ' + (error.response ? error.response.data : error.message));
            }
        }

        document.getElementById('searchInput').addEventListener('input', function () {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => { currentPage = 0; loadJobs(); }, 500);
        });

        document.getElementById('statusFilter').addEventListener('change', function () {
            currentPage = 0; loadJobs();
        });

        function renderPagination() {
            const showingFrom = totalElements === 0 ? 0 : (currentPage * pageSize) + 1;
            const showingTo = Math.min((currentPage + 1) * pageSize, totalElements);
            document.getElementById('showingFrom').textContent = showingFrom;
            document.getElementById('showingTo').textContent = showingTo;
            document.getElementById('totalElements').textContent = totalElements;

            document.getElementById('firstBtn').disabled = currentPage === 0;
            document.getElementById('prevBtn').disabled = currentPage === 0;
            document.getElementById('nextBtn').disabled = currentPage >= totalPages - 1;
            document.getElementById('lastBtn').disabled = currentPage >= totalPages - 1;

            const pageNumbers = document.getElementById('pageNumbers');
            pageNumbers.innerHTML = '';
            let startPage = Math.max(0, currentPage - 2);
            let endPage = Math.min(totalPages - 1, startPage + 4);
            if (endPage - startPage < 4) { startPage = Math.max(0, endPage - 4); }

            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = 'page-btn' + (i === currentPage ? ' active' : '');
                pageBtn.textContent = i + 1;
                pageBtn.onclick = () => goToPage(i);
                pageNumbers.appendChild(pageBtn);
            }
        }

        function goToPage(page) {
            if (page >= 0 && page < totalPages && page !== currentPage) {
                currentPage = page;
                loadJobs();
            }
        }

        function changePageSize() {
            pageSize = parseInt(document.getElementById('pageSizeSelect').value);
            currentPage = 0;
            loadJobs();
        }

        window.onload = loadJobs;
    </script>
</body>
</html>